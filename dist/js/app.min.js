"use strict";angular.module("app",["drupalService","ui.router","app.children","drupalImage","metaInfo","ngSanitize","ngTouch","ui.bootstrap"]).run(["$rootScope","$state","$stateParams","metaInfo","$window","$location",function($rootScope,$state,$stateParams,metaInfo,$window,$location){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.apiUrl="http://helm-marketing.liftoff.albatrossdigital.com/",$rootScope.apiUrl="http://liftoff3.local/",$rootScope.myTownUrl="http://mytown.helmcivic.com",$rootScope.exploreUrl="http://explore.helmcivic.com",$rootScope.menuName="main-menu",$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data){var title=toState.data.title&&toState.data.title.length?toState.data.title:"";metaInfo.setTitle(title);var description=toState.data.description&&toState.data.description.length?toState.data.description:"";metaInfo.setMetaDescription(description);var keywords=toState.data.keywords&&toState.data.keywords.length?toState.data.keywords:[];metaInfo.setMetaKeywords(keywords,toState.data.keywordAppend)}else fromState.data&&metaInfo.resetAll()}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$window.ga&&$window.ga("send","pageview",{page:$location.path(),title:toState.data&&toState.data.title?toState.data.title:"FILLME!"}),fromState.name&&fromState.name.length&&(!toState.data||!toState.data||!toState.data.skipScroll)}),$rootScope.goSubRoute=function(baseRoute,subRoute,baseName){baseName=void 0==baseName?"base":baseName;var stateName=baseRoute+"."+subRoute;try{var state=$state.get(stateName);if(void 0==state||null==state)throw"myException"}catch(e){stateName=baseRoute+"."+baseName}$state.go(stateName)}}]).config(["$locationProvider","$stateProvider","$urlRouterProvider","metaInfoProvider",function($locationProvider,$stateProvider,$urlRouterProvider,metaInfoProvider){metaInfoProvider.setBaseTitle("FILLME!"),metaInfoProvider.setBaseDescription("FILLME!"),metaInfoProvider.setBaseKeywords("FILLME!"),$locationProvider.html5Mode(!0)}]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$stateProvider.state("home",{url:"/",resolve:{links:function($stateParams,MenuLink){return MenuLink.query().$promise.then(function(data){return data.list})},nodes:function($stateParams,Node){return Node.query().$promise.then(function(data){return data.list})}},templateUrl:"views/home.html",controller:function($scope,$rootScope,$state,$filter,links,nodes){$scope.links=links,$scope.nodes=nodes,$scope.parentLinks=$filter("filter")($scope.links,{plid:"0"},!0)}}).state("app",{url:"/app/:nid",resolve:{node:function($stateParams,Node){return Node.get({nid:$stateParams.nid}).$promise.then(function(data){return data})}},templateUrl:"views/app.html",controller:function($scope,$rootScope,$state,$filter,$sce,node){$scope.node=node,$scope.appGo=function(params){$state.go("app",params)}}}).state("mytown",{url:"/mytown",resolve:{node:function($stateParams,Node){return Node.get({nid:16}).$promise.then(function(data){return data})}},templateUrl:"views/mytown.html",controller:function($scope,$rootScope,$state,$filter,$sce,node){$scope.node=node,$scope.url=$rootScope.myTownUrl,$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)}}}).state("explore",{url:"/explore",resolve:{node:function($stateParams,Node){return Node.get({nid:15}).$promise.then(function(data){return data})}},templateUrl:"views/explore.html",controller:function($scope,$rootScope,$state,$filter,$sce,node){$scope.node=node,$scope.url=$rootScope.exploreUrl,$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)}}})}]),angular.module("metaInfo",[]).provider("metaInfo",function(){var baseTitle="",title="",baseMetaDescription="",metaDescription="",baseMetaKeywords="",metaKeywords="";this.setBaseTitle=function(newTitle){baseTitle=newTitle},this.setBaseDescription=function(description){baseMetaDescription=description},this.setBaseKeywords=function(keywords){baseMetaKeywords=keywords},this.$get=function(){return{title:function(){return title.length?title+" | "+baseTitle:baseTitle},setTitle:function(newTitle){title=newTitle},metaDescription:function(){return metaDescription.length?metaDescription:baseMetaDescription},metaKeywords:function(){return metaKeywords.length?metaKeywords:baseMetaKeywords},setMetaDescription:function(newMetaDescription){metaDescription=newMetaDescription},setMetaKeywords:function(newKeywords,append){var keywords="";for(var key in newKeywords)keywords+=", "+newKeywords[key].name;metaKeywords="undefined"!=typeof append&&append?baseMetaKeywords+keywords:keywords},resetAll:function(){title="",metaDescription="",metaKeywords=""}}}}),angular.module("drupalService",["ngResource"]).factory("Token",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"restws/session/token",null,{get:{responseType:"text",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json",console.log("data",data)}}})}]).factory("Node",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"node/:nid.json",{nid:"@nid"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0},query:{dataType:"json",method:"GET",cache:!1,isArray:!1},save:{dataType:"json",method:"POST",headers:{"X-CSRF-Token":$rootScope.token,"Content-Type":"application/json"}}})}]).factory("MenuLink",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"menu_link.json",{menu_name:$rootScope.menuName},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("File",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"file/:fid.json",{fid:"@fid"},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("View",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"rest/:entity/:bundle/:a/:b/:c",{entityType:"@entity",name:"@bundle",a:"@arg0"},{query:{method:"GET",cache:!0,isArray:!0}})}]).factory("TaxonomyTerm",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"taxonomy_term/:tid",{vocabulary:"@vocabulary"},{get:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1},query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermIndex",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"taxonomy_term?vocabulary&sort=weight&direction=ASC",{vocabulary:"@vocabulary"},{query:{method:"GET",transformRequest:function(data,headersGetter){headersGetter().Accept="application/json"},cache:!0,isArray:!1}})}]).factory("TaxonomyTermNodes",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/taxonomy_term_nodes",{tid:"@tid"},{})}]).factory("User",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/user/:uid",{uid:"@uid"},{})}]).factory("Comment",["$resource","$rootScope",function($resource,$rootScope){return $resource($rootScope.apiUrl+"/node/:nid/comments",{nid:"@nid"},{post:{method:"POST",url:"/entity/comment"}})}]).factory("viewsFactory",["View",function(View){var service={};return service.pageLoad=function($scope,params){if(!$scope.loadingPage&&void 0!=$scope.items&&$scope.items.length>0){$scope.currentPage++;var newData=View.query(params,function(){newData.length>0&&(Array.prototype.push.apply($scope.items,newData),$scope.loadingPage=!1)})}$scope.loadingPage=!0},service}]).directive("openReveal",function(){return{restrict:"A",scope:{openReveal:"@"},link:function($scope,$element,$attrs){$element.on("click",function(){jQuery("#"+$scope.openReveal).foundation("reveal","open")})}}}),angular.module("metaInfo").controller("metaInfoCtrl",["$scope","metaInfo",function($scope,metaInfo){$scope.pageTitle=function(){return metaInfo.title()},$scope.metaDescription=function(){return metaInfo.metaDescription()},$scope.metaKeywords=function(){return metaInfo.metaKeywords()}}]),angular.module("app").directive("pageReady",function($window,$browser){return{restrict:"A",link:function($scope,$element,$attrs){$browser.notifyWhenNoOutstandingRequests(function(){document.body.setAttribute("data-status","ready"),$scope.$root.$emit("pageReady"),$scope.$root.$broadcast("pageReady")})}}}),angular.module("app.children",["drupalService"]).directive("children",function($window,$browser,$filter,Node){return{restrict:"E",template:'<div class="block block-children" ng-class="{loading: \'loading\'}" ng-include="getTemplate();"></div>',scope:{parentLink:"=",allLinks:"=links",allNodes:"=nodes",apiUrl:"@"},link:function($scope,$rootScope,$element,$attrs){$scope.loading=!0;var getNode=function(nid){return $filter("filter")($scope.allNodes,{nid:nid})[0]};console.log($scope.parentLink.nid),$scope.node=getNode($scope.parentLink.nid),$scope.nodes=[];var menuLinks=$filter("filter")($scope.allLinks,{plid:$scope.parentLink.mlid});angular.forEach(menuLinks,function(item,key){var node=getNode(item.nid);$scope.nodes.push(node)}),console.log($scope.nodes),$scope.getTemplate=function(){var name=void 0!=$scope.node.field_template?$scope.node.field_template:"features";return"/views/block/"+name+".html"},$scope.extractPath=function(url){return url.replace($scope.apiUrl,"")}}}}),angular.module("drupalImage",["drupalService"]).directive("drupalImageId",function($window,$browser,File){return{restrict:"A",template:'<img src="{{src}}" alt="{{alt}}" title="{{title}}" />',replace:!0,scope:{drupalImageId:"@",drupalImageStyle:"@"},link:function($scope,$rootScope,$element){File.query({fid:$scope.drupalImageId}).$promise.then(function(data){$scope.src=data.url.replace("files/","files/styles/"+$scope.drupalImageStyle+"/public/"),$scope.alt=data.field_file_image_alt_text,$scope.title=data.field_file_image_title_text})}}});